- sr = @query_command.search_results
%h3
  Search summary
=form_tag( {controller: :ppd, action: :create}, {role: "form", class: "ppd-search-terms form form-horizontal"} ) do
  %ul.search-terms.list-inline
    - @preferences.each_search_term do |search_term|
      %li
        = hidden_field_tag( search_term.form_name, search_term.form_value )
        %label
          = search_term.label
          %button.btn.btn-default.search-term{ name: "remove-#{search_term.name}", value: search_term.value, type: :submit }
            %i.fa.fa-times-circle.fa-lg

%h2
  Search results
%p.text-muted.small
  #{sr.properties} properties and #{sr.transactions} transactions found in #{@time_taken}ms

%ul.list-unstyled
  - sr.each_property_address do |results|
    -result = results.first
    %li
      .property
        %span.address
          %span.address-text
            = result.address_fields.join( ", " )
          %span.address-postcode
          #{result.value_of_property "ppd:propertyAddressPostcode"}
      .details
        - result.property_details.each do |d|
          %span.property-detail-tag #{d[:label]}

      .prices.row
        .col-md-4
          %table.table
            %thead
              %tr
                %th
                  Date
                %th.text-right
                  Price
                %th
            %tbody
              - results.each do |result|
                %tr
                  %td
                    = result.value_of_property( "ppd:transactionDate" )
                  %td.text-right
                    = number_to_currency( result.value_of_property( "ppd:pricePaid" ), locale: "en-UK", precision: 0, unit: "&pound;".html_safe )
                  %td.transaction-url
                    %a{ href: result.value_of_property("@id") }
                      %i.fa.fa-external-link



