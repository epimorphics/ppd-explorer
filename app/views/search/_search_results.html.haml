- sr = @query_command.search_results
= render partial: "ppd/workflow_action_buttons"

%h2
  Search results

%ul.search-terms.list-inline
  %li
    #{sr.summarise} by searching for:
  - @preferences.each_search_term do |search_term|
    %li
      %label
        = search_term.label
        %a.search-term{ href: @preferences.as_path( :search, {}, {search_term.name => search_term.value } )}
          %i.fa.fa-times-circle.fa-lg


%ul.list-unstyled.ppd-results
  - odd = true
  - sr.each_property_address do |results|
    - result = results.first
    %li{ class: odd ? "property-entry odd" : "property-entry even"}
      - odd = !odd
      .row
        %h3.property-heading.col-md-12
          %span.address
            = result.formatted_address

      .row
        .col-md-4.detailed-address
          %table.table
            %thead
              %tr
                %th{colspan: 2}
                  Detailed address
            %tbody
              - SearchResult::DETAILED_ADDRESS_ASPECTS.each do |aspect|
                %tr
                  = address_detail_header( aspect, result )
                  = address_detail_filter( aspect, result, @preferences )

        .col-md-4.property-characteristics
          %table.table
            %thead
              %tr
                %th{colspan: 2}
                  Characteristics
            %tbody
              %tr
                %td.property-details-field-title
                  property type
                %td
                  = result.property_type[:label]
              %tr
                %td.property-details-field-title
                  estate type
                %td
                  = result.estate_type[:label]
              %tr
                %td.property-details-field-title
                  new build?
                %td
                  = result.is_new_build

        .col-md-4
          %table.table
            %thead
              %tr
                %th{colspan: 3}
                  Transaction history
            %tbody
              - results.each do |result|
                %tr
                  %td
                    = result.value_of_property( "ppd:transactionDate" )
                  %td.text-right
                    = number_to_currency( result.value_of_property( "ppd:pricePaid" ), locale: "en-UK", precision: 0, unit: "&pound;".html_safe )
                  %td.transaction-url
                    %a{ href: result.value_of_property("@id") }
                      %i.fa.fa-external-link



